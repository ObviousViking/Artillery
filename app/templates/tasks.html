{% extends 'base.html' %}
{% block content %}
<h1>Tasks</h1>
<p>Manage gallery-dl jobs. Launch, pause, edit, or delete tasks.</p>
<div style="overflow-x:auto;">
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Status</th>
            <th>Interval (min)</th>
            <th>Last Run</th>
            <th>Next Run</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for task in tasks %}
        <tr>
            <td style="font-weight:700;">{{ task.display_name }}</td>
            <td><span class="status-badge status-{{ task.status }}">{{ task.status }}</span></td>
            <td>{{ task.interval }}</td>
            <td>{{ task.last_run }}</td>
            <td>{{ task.next_run }}</td>
            <td style="display:flex; gap:0.35rem; flex-wrap:wrap;">
                <form method="post" action="{{ url_for('artillery.run_task', task_name=task.name) }}">
                    <button type="submit">Run</button>
                </form>
                <form method="post" action="{{ url_for('artillery.pause_task', task_name=task.name) }}">
                    <button type="submit" class="btn secondary">{{ 'Resume' if task.status == 'Paused' else 'Pause' }}</button>
                </form>
                <a class="btn" href="{{ url_for('artillery.view_log', task_name=task.name) }}">Log</a>
                <a class="btn" href="{{ url_for('artillery.edit_task', task_name=task.name) }}">Edit</a>
                <form method="post" action="{{ url_for('artillery.delete_archive', task_name=task.name) }}">
                    <button type="submit" class="btn secondary">Delete Archive</button>
                </form>
                <form method="post" action="{{ url_for('artillery.delete_task', task_name=task.name) }}" onsubmit="return confirm('Delete task {{ task.display_name }}?');">
                    <button type="submit" class="btn danger">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr><td colspan="6">No tasks have been created yet.</td></tr>
        {% endfor %}
    </tbody>
</table>
</div>
<div style="margin-top:1.5rem;">
    <a class="btn" href="{{ url_for('artillery.new_task') }}">Create Task</a>
</div>
{% endblock %}
